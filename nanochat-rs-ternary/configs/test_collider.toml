# Test configuration for Collider Token Filtering
# Expected: 35% faster backprop at 35% sparsity

[model]
dim = 512
n_layers = 8
n_heads = 8
n_kv_heads = 2
ffn_mult = 2.67
vocab_size = 4096
max_seq_len = 1024
group_size = 128
mhc_n_streams = 2

[training]
batch_size = 4
total_steps = 1000
log_interval = 50
checkpoint_interval = 500
keep_last_checkpoints = 2

# Collider Token Filtering (arXiv:2502.00340)
# Filters low-importance tokens during backward pass for speedup
use_collider = true
collider_threshold = 0.3      # Filter tokens with importance < 0.3
collider_sparsity = 0.35      # Target 35% sparsity

# Standard optimizer settings
use_8bit_optim = false
use_galore = false
muon_lr = 0.02
muon_momentum = 0.95
lion_lr = 0.0001
warmup_steps = 100
gradient_clip_norm = 1.0

# mHC architecture
use_mhc = true

# Regularization
entropy_weight = 0.01

# Expected Benefits:
# - Backprop speedup: 35% (from 35% sparsity)
# - End-to-end speedup: ~15-20% (backward is ~66% of total time)
# - Memory reduction: ~5% (fewer activations stored)
# - Quality impact: < 1% (minimal degradation)

# Healthy Sparsity Range: 20-50%
# - < 20%: Too conservative, minimal benefit
# - 20-50%: Sweet spot (recommended)
# - > 50%: Risk of quality degradation
